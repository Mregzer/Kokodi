CREATE TABLE cards (
name VARCHAR(255) NOT NULL,
value INTEGER,
card_type VARCHAR(255),
CONSTRAINT pk_cards PRIMARY KEY (name)
);


CREATE TABLE sessions (
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
status VARCHAR(255),
score_board BIGINT,
created_by BIGINT NOT NULL,
CONSTRAINT pk_sessions PRIMARY KEY (id)
);

CREATE TABLE turns (
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
player BIGINT,
target BIGINT,
card_name VARCHAR(255),
sessions_id BIGINT,
CONSTRAINT pk_turns PRIMARY KEY (id)
);

CREATE TABLE users (
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
username VARCHAR(255),
login VARCHAR(255),
password VARCHAR(255),
role VARCHAR(15),
CONSTRAINT pk_users PRIMARY KEY (id)
);

CREATE TABLE player_scores (
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
user_id BIGINT NOT NULL,
game_session_id BIGINT NOT NULL,
score INTEGER,
CONSTRAINT pk_player_scores PRIMARY KEY (id)
);

CREATE TABLE cards_sessions (
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
card_id VARCHAR(255) NOT NULL,
session_id BIGINT NOT NULL,
CONSTRAINT pk_cards_sessions PRIMARY KEY (id)
);

CREATE TABLE users_sessions (
session_id BIGINT NOT NULL,
user_id BIGINT NOT NULL
);

CREATE INDEX user_login_idx
ON users (login);

ALTER TABLE player_scores ADD CONSTRAINT FK_SCORES_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

ALTER TABLE player_scores ADD CONSTRAINT FK_SCORES_ON_GAME_SESSION FOREIGN KEY (game_session_id) REFERENCES sessions (id);

ALTER TABLE sessions ADD CONSTRAINT FK_USER_ON_SESSION FOREIGN KEY (created_by) REFERENCES users (id);

ALTER TABLE cards_sessions ADD CONSTRAINT FK_CARSES_ON_CARD FOREIGN KEY (card_id) REFERENCES cards (name);

ALTER TABLE cards_sessions ADD CONSTRAINT FK_CARSES_ON_GAME_SESSION FOREIGN KEY (session_id) REFERENCES sessions (id);

ALTER TABLE turns ADD CONSTRAINT FK_TURNS_ON_CARD_NAME FOREIGN KEY (card_name) REFERENCES cards (name);

ALTER TABLE turns ADD CONSTRAINT FK_TURNS_ON_PLAYER FOREIGN KEY (player) REFERENCES users (id);

ALTER TABLE turns ADD CONSTRAINT FK_TURNS_ON_SESSIONS FOREIGN KEY (sessions_id) REFERENCES sessions (id);

ALTER TABLE turns ADD CONSTRAINT FK_TURNS_ON_TARGET FOREIGN KEY (target) REFERENCES users (id);

ALTER TABLE users_sessions ADD CONSTRAINT FK_USESES_ON_GAME_SESSION FOREIGN KEY (session_id) REFERENCES sessions (id);

ALTER TABLE users_sessions ADD CONSTRAINT FK_USESES_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

INSERT INTO cards (name, value, card_type)
VALUES
('Block', 1, 'ACTIONS'),
('Steal 1', 1, 'ACTIONS'),
('Steal 3', 3, 'ACTIONS'),
('Steal 5', 5, 'ACTIONS'),
('DoubleDown', 2, 'ACTIONS'),
('Points 2', 2, 'POINTS'),
('Points 4', 4, 'POINTS'),
('Points 6', 6, 'POINTS'),
('Points 8', 8, 'POINTS'),
('Points 10', 10, 'POINTS');